# 存储系统
*现代计算机系统都**以存储器为中心**，在计算机运行过程中，存储器是各种信息存储和交换的中心*

<img src = "./图片/信息存储和交换.png" width = 60%>

---
## 存储系统原理
- 存储器和存储系统的性能指标： 速度，容量，价格

### 1. 存储系统的定义
* 存储器：
    - 用途：主存储器（内存），Cache。通用寄存器，磁盘存储器等
    - 材料工艺：SRAM,DRAM，磁表面，激光等
    - 访问方式：直接译码，随机访问，相联访问，先进先出，快传送等
    
* 存储系统：
    - 定义：两个或两个以上速度、容量和价格各不相同的存储器**用硬件、软件、或软件与硬件相结合的方法**连接起来成为一个系统。该系统对应用程序员透明，从外部看就是一个存储器。
    - 存储容量 S
        - 存储系统的容量要尽可能的接近于容量最大的存储器
        - 编址方式：
            1. 选择对容量的大存储器进行编址，小存储器可以不编址（如Cache存储系统）  
            2. 在系统内部对多个存储器分别进行编址，且设计一个逻辑地址空间。将多个存储器的地址映射到该逻辑地址上（如虚拟存储系统）
    
    - 单位容量的平均价格 C
        - 公式：$ C = \frac{C_1 * S_1 + C_2 * S_2}{S_1 + S_2 }$
        - S1和S2不能相差太大
        
    - 访问周期 T
        - 命中率：$H = \frac{N_1}{N_1+N_2}，N_1，N_2$表示访问次数
        - 访问周期：$T = HT_1+(1-H)T_2$
        - 访问效率:(与命中率和构成存储系统的两级存储器速度之别有关)
            \begin{align*}
                e & = \frac{T_1}{T}\\
                    & = \frac{1}{H + (1-H)\frac{T_2}{T_1}}\\
                    & = f(H,\frac{T_2}{T_1})
            \end{align*}
    
    - 提高存储系统速度的两条途径
        1. 提高命中率 H
            - 预取技术：不命中时，在数据从主存储器中取出送往CPU的同时，把主存储器相邻的几个单元中的数据（称为一个数据块）都取出来送入Cache中。下次命中的概率为：
            
            $H' = \frac{H+n-1}{n}$，n为Cache中块大小与数据块重复使用次数的乘积，H是原来的命中率
        2. 让两个存储器的速度之比不要太大（虚拟存储器做不到）

    - 举例
        - <img src = "./图片/存储系统.png" width = 60% >
        - 速度：$ T \approx min(T_1,T_2,...,T_n)$
        - 容量：$ S \approx max(S_1,S_2,...,S_n)$
        - 价格：$ C \approx min(C_1,C_2,...,C_n)$

    - 两种存储系统
        * Cache存储系统
            - 由Cache和主存储器构成，全部由硬件来调度
            - 速度接近于Cache的速度，容量是主存的容量，价格接近主存的价格
            - **目标：提高存储器的速度**
        * 虚拟存储系统
            - 由主存储器和磁盘存储器构成，需要操作系统的存储管理系统来调度
            - 速度接近于主存的速度，容量是虚拟地址空间，价格接近磁盘的价格
            - **目的：增加存储器的容量**
            
        ---
        - Cache: 一般用高速静态存储器（SRAM）实现。程序员不编址Cache，因为Cache是采用相联方式访问
        - 主存：一般用动态存储器（DRAM）实现
        ---
    

### 2. 存储器的层次结构
<img src = "./图片/存储器的层次结构.png" width = 80%>

* 各存储器的主要性能特性

    |存储器层次|通用寄存器|缓冲栈| Cache | 主存储器 | 磁盘存储器 | 脱机存储器 |
    |:-------:|:-------:|:----:|:-----:|:-------:|:---------:|:----------:|
    |存储周期|<10ns|<10ns|10ns~60ns|60ns~300ns|10ms~30ms|2min~20min|
    |存储容量|<512B|<512B|8KB~2MB|32MB~1GB|1GB~1TB|5GB~10TB|
    |价格（$C/KB）| 1200|80|3.2|0.36|0.01|0.0001|
    | 访问方式 |直接译码|先进先出|相联访问|随机访问|快访问|文件组|
    |材料工艺|ECL|ECL|SRAM|SDRAM|磁表面|磁、光等|
    |分配管理|编译器分配|硬件调度|硬件调度|操作系统|系统/用户|系统/用户|
    |带宽(MB/S)|400~8000|400~1200|200~800|80~160|10~100|0.2~0.6|

### 3. 频带平衡
- 目的: 解决因CPU与主存储器的速度差距越来越大而导致两者不能匹配工作的问题；计算机系统中各级存储器的频带达到平衡。
- 方法：
    - 多个存储器并行工作
    - 设置多种缓冲存储器
    - 采用存储系统
    
### 4. 并行存储器 
- 并行访问存储器
- 交叉访问存储器
- 一种无访问冲突存储器